# Práctica de Laboratorio: Enumeración y Explotación de FTP

**Objetivo:** Identificar y explotar una configuración insegura común en servidores FTP (File Transfer Protocol): el acceso anónimo.

**Máquinas y Servicios Requeridos:**
*   Una VM con Kali Linux (atacante).
*   Una VM con Windows 8.1 (víctima).
*   Un servidor FTP instalado en la víctima. **FileZilla Server** es una opción gratuita y fácil de instalar para este propósito.

---

## Parte 1: Configuración del Servidor FTP en Windows 8.1 (Víctima)

1.  **Descarga e Instala FileZilla Server:** Bájalo desde su web oficial e instálalo en tu VM de Windows 8.1 con las opciones por defecto.
2.  **Configura el Acceso Anónimo:**
    *   Abre la interfaz de administración de FileZilla Server.
    *   Ve a `Edit` > `Users`.
    *   En el panel "Users", haz clic en `Add` y crea un usuario llamado `anonymous`. No le asignes contraseña.
    *   En la página "Shared folders", añade una carpeta a la que este usuario pueda acceder (por ejemplo, crea una carpeta `C:\FTP_Share` en tu disco).
    *   Dale permisos de `Read` y `Write` a esa carpeta para el usuario `anonymous`.
3.  **Asegúrate de que el servidor está corriendo** y que el firewall de Windows permite las conexiones entrantes en el puerto 21.

---

## Parte 2: Descubrimiento y Enumeración desde Kali Linux

### Paso 1: Encontrar el Servidor FTP

Primero, verificamos qué máquinas en la red tienen el puerto 21 (el puerto estándar de FTP) abierto.

```bash
# Escanea la red en busca del puerto TCP 21
sudo nmap -p 21 [RANGO_DE_TU_RED_NAT_LAB]
```

Una vez que identifiques la IP de tu máquina Windows (`[IP_VICTIMA]`), puedes hacer un escaneo más profundo para obtener la versión del software del servidor FTP.

```bash
# Escaneo de versión y scripts por defecto en el puerto 21
sudo nmap -p 21 -sV -sC [IP_VICTIMA]
```

El script `-sC` de Nmap (`--script=default`) incluye una comprobación (`ftp-anon`) que te dirá inmediatamente si el login anónimo está habilitado. ¡Presta atención a la salida!

---

## Parte 3: Explotación del Acceso Anónimo

Si Nmap confirma que el acceso anónimo está permitido, podemos conectarnos y explorar el servidor.

### Paso 1: Conectarse con el cliente FTP

```bash
# Inicia una conexión FTP con la máquina víctima
ftp [IP_VICTIMA]
```

### Paso 2: Iniciar Sesión como Anónimo

El servidor te pedirá un nombre de usuario (`Name`).

1.  Escribe `anonymous` y presiona `Enter`.
2.  Luego te pedirá una contraseña (`Password`). Simplemente presiona `Enter` sin escribir nada.

Si la configuración es vulnerable, verás un mensaje de bienvenida (`230 Login successful`) y el prompt cambiará a `ftp>`. ¡Estás dentro!

### Paso 3: Interactuar con el Servidor FTP

Ahora puedes usar comandos estándar de FTP para explorar y transferir archivos.

```ftp
# Muestra los comandos disponibles
ftp> help

# Lista los archivos y directorios en el servidor remoto
ftp> ls

# Descarga un archivo del servidor a tu máquina Kali
ftp> get [nombre_del_archivo_remoto]

# Sube un archivo desde tu máquina Kali al servidor
ftp> put [nombre_del_archivo_local]
```

**Ejemplo práctico:**

1.  En tu máquina Kali, crea un archivo de prueba:
    ```bash
    echo "Archivo subido desde Kali" > exploit.txt
    ```
2.  Dentro de la sesión `ftp>`, súbelo:
    ```ftp
    ftp> put exploit.txt
    ```
3.  Verifica que se ha subido:
    ```ftp
    ftp> ls
    ```
4.  Sal de la sesión de FTP:
    ```ftp
    ftp> bye
    ```

---

## Conclusión

El acceso anónimo a un servidor FTP con permisos de escritura es una vulnerabilidad crítica. Permite a un atacante subir archivos maliciosos (como un webshell o un troyano) al sistema víctima, que luego podrían ser ejecutados a través de otra vulnerabilidad o por un usuario descuidado. Siempre se debe deshabilitar el acceso anónimo a menos que sea estrictamente necesario y, en ese caso, limitar los permisos a solo lectura.