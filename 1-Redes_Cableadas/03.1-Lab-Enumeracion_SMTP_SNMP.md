# Práctica de Laboratorio: Enumeración y Explotación Básica de SMTP y SNMP

Esta guía está diseñada para que puedas practicar la enumeración y explotación básica de los servicios SMTP y SNMP en un entorno de laboratorio, siguiendo el mismo enfoque pedagógico y técnico que el lab de SMB.

**Objetivo:** Descubrir información sensible y posibles vectores de ataque en servicios SMTP y SNMP expuestos en una máquina Linux desde Kali Linux.

**Máquinas Requeridas:**
* Una VM con Kali Linux (atacante).
* Una VM con Linux (víctima) con servicios SMTP y SNMP activos en la misma red NAT.

---

## Parte 1: Descubrimiento de Servicios y Puertos

### Paso 1: Identificar la IP de la máquina víctima

Escanea el rango de tu red NAT para identificar la IP de la máquina con los puertos SMTP (25, 587) y SNMP (161) abiertos.

```bash
# Escaneo de puertos relevantes
nmap -p 25,587,161 [RANGO_DE_TU_RED_NAT_LAB]
```

Apunta la IP de la máquina que tenga estos puertos abiertos para los siguientes pasos.

---

## Parte 2: Enumeración de SNMP

### Paso 1: Enumerar información con Nmap

Utiliza los scripts NSE de Nmap para obtener información del servicio SNMP.

```bash
# Enumeración básica de SNMP
nmap -sU -p 161 --script snmp-info,snmp-brute [IP_VICTIMA]
```

Analiza la salida para encontrar:
* Cadenas de comunidad (`public`, `private`)
* Información del sistema operativo, interfaces de red, usuarios, rutas, etc.

### Paso 2: SNMP Walk con snmpwalk

Si encuentras una cadena de comunidad válida, realiza un SNMP walk para extraer información detallada.

```bash
# Ejemplo con cadena de comunidad 'public'
snmpwalk -v2c -c public [IP_VICTIMA]
```

Busca datos sensibles como nombres de usuario, rutas, configuraciones de red y versiones de software.

---

## Parte 3: Enumeración y Pruebas en SMTP

### Paso 1: Verificar relé abierto con Nmap

Comprueba si el servidor SMTP permite enviar correos sin autenticación (relé abierto).

```bash
nmap --script smtp-open-relay.nse -p 25 [IP_VICTIMA]
```

Si el relé está abierto, el servidor es vulnerable a envío de spam y suplantación.

### Paso 2: Enumerar usuarios con smtp-user-enum

Utiliza la herramienta `smtp-user-enum` para descubrir usuarios válidos en el servidor SMTP.

```bash
# Crea un archivo con posibles nombres de usuario
echo -e "root\nadmin\nuser\nmail" > users.txt

# Ejecuta la enumeración
smtp-user-enum -M VRFY -U users.txt -t [IP_VICTIMA]
```

Analiza la salida para identificar usuarios válidos.

### Paso 3: Interactuar manualmente con SMTP (opcional)

Puedes usar `telnet` para interactuar directamente con el servidor SMTP y probar comandos como HELO, VRFY, EXPN, etc.

```bash
telnet [IP_VICTIMA] 25
# Prueba comandos como:
HELO kali
VRFY root
EXPN admin
QUIT
```

---

## Parte 4: Documenta y Analiza los Resultados

* ¿Qué información sensible has obtenido de SNMP?
* ¿El servidor SMTP es vulnerable a relé abierto o permite enumeración de usuarios?
* ¿Qué riesgos existen y cómo podrías explotarlos como atacante?

---

¡Has completado la práctica! Ahora tienes experiencia en la enumeración y explotación básica de servicios SMTP y SNMP, y puedes aplicar técnicas de hardening para proteger estos servicios en sistemas Linux.