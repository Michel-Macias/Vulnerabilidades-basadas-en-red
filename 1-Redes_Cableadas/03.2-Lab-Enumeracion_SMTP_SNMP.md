# Práctica de Laboratorio: Enumeración de SMTP y SNMP

**Objetivo:** Utilizar herramientas de enumeración para descubrir información sensible de los servicios SMTP (Simple Mail Transfer Protocol) y SNMP (Simple Network Management Protocol).

**Máquinas y Servicios Requeridos:**
*   Una VM con Kali Linux (atacante).
*   Un sistema víctima con un servidor SMTP y/o un agente SNMP habilitado. (Nota: Windows 8.1 no los trae por defecto. Esta práctica es conceptual y aplicable a servidores o dispositivos de red).

---

## Parte 1: Enumeración de Usuarios con SMTP

Los servidores de correo antiguos o mal configurados a veces exponen comandos que permiten verificar la existencia de usuarios (`VRFY`) o expandir listas de correo (`EXPN`). Aunque es raro hoy en día, muchos servidores todavía responden de forma diferente a un intento de envío (`RCPT TO`) a un usuario existente vs. uno inexistente, lo que permite la enumeración.

### Paso 1: Preparar una lista de posibles usuarios

Crea un archivo de texto con nombres de usuario comunes que quieras probar.

```bash
# Creamos una lista de usuarios para probar
echo "root" > userlist.txt
echo "admin" >> userlist.txt
echo "test" >> userlist.txt
echo "soporte" >> userlist.txt
echo "m1txel" >> userlist.txt
```

### Paso 2: Usar Nmap para la enumeración SMTP

Nmap tiene un script (`smtp-enum-users`) que automatiza la enumeración usando varias técnicas.

```bash
# Reemplaza [IP_VICTIMA] con la IP del servidor a auditar
# El script intentará usar los comandos VRFY, EXPN y RCPT TO
sudo nmap -p 25 --script smtp-enum-users [IP_VICTIMA]
```

### Paso 3: Usar una herramienta dedicada como smtp-user-enum

Esta herramienta está diseñada específicamente para este propósito y puede ser muy efectiva.

```bash
# -M especifica el modo (VRFY, EXPN, RCPT)
# -U es la lista de usuarios
# -t es el objetivo
smtp-user-enum -M VRFY -U userlist.txt -t [IP_VICTIMA]
```

**Análisis de Resultados:** Si el servidor es vulnerable, las herramientas te devolverán una lista de los usuarios que existen en el sistema. Esta información es muy valiosa para posteriores ataques de fuerza bruta o phishing dirigido.

---

## Parte 2: Extracción de Información con SNMP

SNMP se usa para gestionar dispositivos de red. A menudo, se deja configurado con "community strings" por defecto, como `public` (para lectura) y `private` (para escritura). Una community string es como una contraseña. Si conocemos la de lectura, podemos extraer una cantidad enorme de información del dispositivo.

### Paso 1: Descubrir hosts con SNMP habilitado

SNMP normalmente opera en el puerto **UDP 161**.

```bash
# Escaneo UDP en el puerto 161 para encontrar dispositivos con SNMP
sudo nmap -sU -p 161 [RANGO_DE_TU_RED_NAT_LAB]
```

### Paso 2: Enumerar con snmp-check

`snmp-check` es una herramienta fantástica que, dada una IP y una community string, vuelca toda la información que puede obtener.

```bash
# Intentamos enumerar el dispositivo usando la community string "public"
snmp-check -t [IP_VICTIMA] -c public
```

**Análisis de Resultados:** Si el comando tiene éxito, verás una gran cantidad de información, que puede incluir:
*   Nombre del host y versión del sistema operativo.
*   Tiempo de actividad del sistema.
*   Lista de interfaces de red con sus IPs y estado.
*   Tabla de enrutamiento.
*   Lista de procesos en ejecución.
*   Puertos TCP/UDP abiertos.
*   A veces, incluso nombres de usuario.

Esta información proporciona un mapa casi completo del sistema y su rol en la red, facilitando enormemente los siguientes pasos de un ataque.

### Paso 3: Enumerar con Nmap (Alternativa)

Nmap también tiene scripts muy potentes para SNMP.

```bash
# Este script intenta obtener toda la información posible
sudo nmap -sU -p 161 --script snmp-info [IP_VICTIMA]

# Este otro script intenta "caminar" por todo el árbol de información de SNMP
sudo nmap -sU -p 161 --script snmp-walk [IP_VICTIMA]
```

---

## Conclusión

Has aprendido a explotar configuraciones débiles en SMTP y SNMP para obtener información crítica. En un entorno real, encontrar un agente SNMP con la community string "public" es como encontrar una mina de oro de información de reconocimiento.